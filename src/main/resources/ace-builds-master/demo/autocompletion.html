<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ACE Autocompletion demo</title>
  <style type="text/css" media="screen">
    body {
        overflow: hidden;
    }
    
    #editor { 
        margin: 0;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
    }
  </style>
</head>
<body>

<pre id="editor"></pre>

<script src="../gherkin-steps.js"></script>
<!-- load ace -->
<script src="../src/ace.js"></script>
<!-- load ace language tools -->
<script src="../src/ext-language_tools.js"></script>
<script>
    if (!Array.prototype.indexOf) {
       Array.prototype.indexOf = function(item) {
          var i = this.length;
          while (i--) {
             if (this[i] === item) return i;
          }
          return -1;
       }
    }

    // trigger extension
    var langTools = ace.require("ace/ext/language_tools");
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/gherkin");
    editor.setTheme("ace/theme/chrome");
    // enable autocompletion and snippets
    editor.setOptions({
        enableBasicAutocompletion: true,
        enableSnippets: true,
        enableLiveAutocompletion: false
    });
    editor.$blockScrolling = Infinity;
    editor.session.setTabSize(2);
    editor.setShowInvisibles(true);

    var likeCompleter = {
        getCompletions: function(editor, session, pos, prefix, callback) {
            var results = [];

            // Add substring matches first
            var i;
            for (i = 0; i < simplePotentials.length; i++) {
              if (simplePotentials[i].toLowerCase().indexOf(prefix.toLowerCase()) >= -1) {
                results.push(simplePotentials[i]);
              }
            }

            // Add other matches after
            for (i = 0; i < simplePotentials.length; i++) {
              if (results.indexOf(simplePotentials[i]) == -1) {
                results.push(simplePotentials[i]);
              }
            }

            if (results.length == 0) { callback(null, []); return; }

            for (i = 0 ; i < results.length ; i++) {
              callback(null , [{name: results[i], value: results[i], score: 200+i, meta: 'best'}]);
            }
            return;
        }
    }
    langTools.addCompleter(likeCompleter);

    var config = ace.require("ace/config");
    config.loadModule("ace/ext/keybinding_menu", function(module) {
            module.init(editor);
    });

    var net = require("ace/lib/net");
    net.get("/ace-builds-master/t.feature", function(t){
        var el = document.getElementById("editor");
        el.env.editor.setValue(t, 1);
    });

    editor.commands.addCommand(
    {
        name: "saveDocument",
        bindKey: {win: "Ctrl-s", mac: "Command-s"},
        exec: function(editor)
        {
            var xhr = new XMLHttpRequest();
            xhr.open("PUT" , "/data/t.feature" , true);
            xhr.send(editor.getValue());
        }
    });

</script>

</body>
</html>
