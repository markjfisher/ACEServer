<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ACE Autocompletion demo</title>
  <link rel="stylesheet" href="kitchen-sink/styles.css" type="text/css" media="screen" charset="utf-8">
</head>
<body>
<div id="optionsPanel" style="position:absolute;height:100%;width:275px">
    <a href="http://www.replicanet.com" title="ReplicaNet">
        <img id="rn-logo" src="rnlogo.png" style="width: 172px;margin: -9px 30px -12px 51px;">
    </a>
    <div style="position: absolute; overflow: hidden; top:115px; bottom:0">
        <div style="width: 100%; height:100%; ">
            <iframe class="menu" src="../fileList.html" style="width:100%; height:100%;"></iframe>
        </div>
    </div>
</div>

<div id="editor-container"></div>

<script src="../gherkin-steps.js"></script>
<!-- load ace -->
<script src="../src/ace.js"></script>
<!-- load ace language tools -->
<script src="../src/ext-language_tools.js"></script>
<script>
    function getQueryVariable(variable)
    {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++)
        {
            var pair = vars[i].split("=");
            if(pair[0] == variable){return pair[1];}
        }
        return(false);
    }

    if (!Array.prototype.indexOf) {
       Array.prototype.indexOf = function(item) {
          var i = this.length;
          while (i--) {
             if (this[i] === item) return i;
          }
          return -1;
       }
    }

    // trigger extension
    var langTools = ace.require("ace/ext/language_tools");
    var editor = ace.edit("editor-container");
    editor.session.setMode("ace/mode/gherkin");
    editor.setTheme("ace/theme/chrome");
    langTools.setCompleters([langTools.keyWordCompleter , langTools.snippetCompleter]);    // This removes hints for single words (no textCompleter)
    // enable autocompletion and snippets
    editor.setOptions({
        enableBasicAutocompletion: true,
        enableSnippets: true,
        enableLiveAutocompletion: false
    });
    editor.$blockScrolling = Infinity;
    editor.session.setTabSize(2);
    editor.setShowInvisibles(true);
    editor.focus();

    var likeCompleter = {
        getCompletions: function(editor, session, pos, prefix, callback) {
            var results = [];

            // Add substring matches first
            var i;
            for (i = 0; i < simplePotentials.length; i++) {
              if (simplePotentials[i].toLowerCase().indexOf(prefix.toLowerCase()) >= -1) {
                results.push(simplePotentials[i]);
              }
            }

            // Add other matches after
            for (i = 0; i < simplePotentials.length; i++) {
              if (results.indexOf(simplePotentials[i]) == -1) {
                results.push(simplePotentials[i]);
              }
            }

            if (results.length == 0) { callback(null, []); return; }

            for (i = 0 ; i < results.length ; i++) {
              callback(null , [{name: results[i], value: results[i], score: 200+i, meta: 'best'}]);
            }
            return;
        }
    }
    langTools.addCompleter(likeCompleter);

    var config = ace.require("ace/config");
    config.loadModule("ace/ext/keybinding_menu", function(module) {
            module.init(editor);
    });

    var net = require("ace/lib/net");

    var filename = "features/newFile.feature";
    if (getQueryVariable("filename") != "") {
        filename = getQueryVariable("filename");
    }

    net.get("/ace-builds-master/" + filename, function(t){
        var el = document.getElementById("editor-container");
        el.env.editor.setValue(t, 1);
        editor.focus();
    });

    editor.commands.addCommand(
    {
        name: "saveDocument",
        bindKey: {win: "Ctrl-s", mac: "Command-s"},
        exec: function(editor)
        {
            var xhr = new XMLHttpRequest();
            xhr.open("PUT" , "/data/"  + filename , true);
            xhr.send(editor.getValue());
        }
    });

</script>

</body>
</html>
